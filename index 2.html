
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üì∑ Frame to Camera Renamer</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 2rem;
      background-color: #f7f7f7;
      color: #333;
    }
    h1 {
      font-size: 2em;
    }
    label {
      font-weight: bold;
      display: block;
      margin: 1rem 0 0.25rem;
    }
    input[type="file"] {
      margin-bottom: 1rem;
    }
    button {
      background-color: #2c6bed;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background-color: #194dc2;
    }
    #missing-frames {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #fff3cd;
      border-left: 5px solid #ffa502;
    }
    #missing-frames ul {
      columns: 4;
      -webkit-columns: 4;
      -moz-columns: 4;
    }
    #missing-frames ul li {
      list-style-type: disc;
      margin-left: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>üì∑ Frame to Camera Renamer</h1>
  <p>Upload a CSV file and the matching JPEG images to rename them using the camera names.</p>

  <label for="csvFile">Upload CSV:</label>
  <input type="file" id="csvFile" accept=".csv" />

  <label for="imageFiles">Upload JPEG images:</label>
  <input type="file" id="imageFiles" multiple accept=".jpg,.jpeg" />

  <br><br>
  <button onclick="processAndZip()">Generate ZIP</button>

  <div id="missing-frames" style="display:none;">
    <h2>‚ö†Ô∏è Missing Frames</h2>
    <ul id="missingList"></ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    async function processAndZip() {
      const csvFile = document.getElementById("csvFile").files[0];
      const imageFiles = document.getElementById("imageFiles").files;

      if (!csvFile || imageFiles.length === 0) {
        alert("Please upload both a CSV and JPEG files.");
        return;
      }

      const csvText = await csvFile.text();
      const rows = csvText.split(/\r?\n/).filter(Boolean);
      const headers = rows[0].split(",");
      const frameIdx = headers.findIndex(h => h.toLowerCase() === "frame");
      const camNameIdx = headers.findIndex(h => h.toLowerCase().includes("camera_name"));

      if (frameIdx === -1 || camNameIdx === -1) {
        alert("CSV must include 'frame' and 'camera_name' headers.");
        return;
      }

      const frameToCamera = {};
      for (let i = 1; i < rows.length; i++) {
        const cells = rows[i].split(",");
        const frame = parseInt(cells[frameIdx]);
        const cam = cells[camNameIdx].split(".")[0]; // remove .001 etc.
        if (!isNaN(frame)) frameToCamera[frame] = cam;
      }

      const fileMap = {};
      for (const file of imageFiles) {
        const base = file.name.split(".")[0];
        const frame = parseInt(base.replace(/^0+/, "")); // remove leading zeros
        fileMap[frame] = file;
      }

      const zip = new JSZip();
      const missing = [];

      for (const frame in frameToCamera) {
        const f = parseInt(frame);
        const file = fileMap[f];
        if (file) {
          const camName = frameToCamera[f] + ".jpeg";
          zip.file(camName, file);
        } else {
          missing.push(f);
        }
      }

      if (missing.length > 0) {
        const missingDiv = document.getElementById("missing-frames");
        const missingList = document.getElementById("missingList");
        missingList.innerHTML = "";
        missing.sort((a,b) => a-b).forEach(f => {
          const li = document.createElement("li");
          li.textContent = f;
          missingList.appendChild(li);
        });
        missingDiv.style.display = "block";
      } else {
        document.getElementById("missing-frames").style.display = "none";
      }

      const blob = await zip.generateAsync({ type: "blob" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "renamed_images.zip";
      link.click();
    }
  </script>
</body>
</html>
